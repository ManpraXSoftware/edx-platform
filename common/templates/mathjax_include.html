## mako
## File: templates/mathjax_include.html
##
## Note that this file is only used by LMS.
## MathJax configuration for Studio lives in
## cms/js/require-config.js.

<%page args="disable_fast_preview=True" expression_filter="h" />

## Avoid loading mathjax if already loaded on the page

%if context.get('load_mathjax', True):

%if disable_fast_preview:
<script type="text/javascript">
  // Fast Preview was introduced in 2.5. However, it
  // causes undesirable flashing/font size changes when
  // MathJax is used for interactive preview (equation editor).
  // Setting processSectionDelay to 0 (see below) fully eliminates
  // fast preview, but to reduce confusion, we are also setting
  // the option as displayed in the context menu to false.
  // When upgrading to 2.6, check if this variable name changed.
  window.MathJax = {
    menuSettings: { CHTMLpreview: false }
  };
</script>
%endif

%if mathjax_mode is not Undefined and mathjax_mode == 'wiki':
<script type="text/javascript">
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ["\\(", "\\)"]],
      displayMath: [['$$', '$$'], ["\\[", "\\]"]],
      autoload: {
        color: [],
        colorv2: ['color']
      },
      packages: { '[+]': ['noerrors'] }
    },
    options: {
      ignoreHtmlClass: 'tex2jax_ignore',
      processHtmlClass: 'tex2jax_process',
      sre: { speech: "deep", domain: "clearspeak", style: "default", locale: "en" }, menuOptions: { settings: { explorer: true } }
    },
    loader: {
      load: ['input/asciimath', '[tex]/noerrors']
    },
    menuSettings: {
      collapsible: true,
      autocollapse: false,
      explorer: true
    },
  };
</script>
%else:
<script type="text/javascript">
  window.MathJax = {
    tex: {
      inlineMath: [
        ["\\(", "\\)"],
        ['[mathjaxinline]', '[/mathjaxinline]']
      ],
      displayMath: [
        ["\\[", "\\]"],
        ['[mathjax]', '[/mathjax]']
      ],
      autoload: {
        color: [],
        colorv2: ['color']
      },
      packages: { '[+]': ['noerrors'] }
    },
    options: {
      ignoreHtmlClass: 'tex2jax_ignore',
      processHtmlClass: 'tex2jax_process',
      sre: { speech: "deep", domain: "clearspeak", style: "default", locale: "en" }, menuOptions: { settings: { explorer: true } }
    },
    loader: {
      load: ['input/asciimath', '[tex]/noerrors']
    },
    menuSettings: {
      collapsible: true,
      autocollapse: false,
      explorer: true
    },
  };
</script>
%endif
<script type="text/javascript">

  // window.MathJax.signal.Interest(function (message) {
  //   if (message[0] === "End Math") {
  //     set_mathjax_display_div_settings();
  //   }
  // });
  // function set_mathjax_display_div_settings() {
  //   $('.MathJax_Display').each(function (index) {
  //     this.setAttribute('tabindex', '0');
  //     this.setAttribute('aria-live', 'off');
  //     this.removeAttribute('role');
  //     this.removeAttribute('aria-readonly');
  //   });
  // }
</script>

<!-- This must appear after all mathjax-config blocks, so it is after the imports from the other templates.
     It can't be run through static.url because MathJax uses crazy url introspection to do lazy loading of
     MathJax extension libraries -->
<script>
  (function (){
    var script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
    document.head.appendChild(script);
    // var script2 = document.createElement('script');
    // script2.innerHTML = "\
    //   \
    // let mathjax_promise = Promise.resolve();  // Used to hold chain of typesetting calls \
    // function typeset(code) { \
    // mathjax_promise = mathjax_promise.then(() => MathJax.typesetPromise(code())) \
    //                .catch((err) => console.log('Typeset failed: ' + err.message)); \
    // return mathjax_promise; \
    // } "
    // function typeset(code) { 
    // mathjax_promise = mathjax_promise.then(() => MathJax.typesetPromise(code())) 
    //                .catch((err) => console.log('Typeset failed: ' + err.message)); 
    // return mathjax_promise; 
    // }
  // window.MathJax.typeset(function() { 
  //     const main = document.querySelector('#main'); 
  //     return main; 
  // }); 
  if (typeof MathJax.typeset !== 'undefined' && MathJax.typeset !== null) {
    MathJax.typeset([document.querySelector('#main')])
  }
  
// document.head.appendChild(script2)
  })();
</script>
<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"/> -->

%endif
<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>
  <!--[if gte mso 9]><xml>
<mso:CustomDocumentProperties>
<mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_SharedWithUsers msdt:dt="string">Subodha Members</mso:display_urn_x003a_schemas-microsoft-com_x003a_office_x003a_office_x0023_SharedWithUsers>
<mso:SharedWithUsers msdt:dt="string">8;#Subodha Members</mso:SharedWithUsers>
</mso:CustomDocumentProperties>
</xml><![endif]-->
</head>